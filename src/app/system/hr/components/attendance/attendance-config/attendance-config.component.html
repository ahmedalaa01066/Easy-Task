<div class="candidates-page">
    <!-- Header Section -->
    <div class="header-content">
        <div class="title-section">
            <h1 class="page-title">Configure Attendance</h1>
        </div>
    </div>

    <!-- search -->
    <div class="top-controls">
        <!-- Search Box -->
        <div class="search-wrapper">
            <span class="pi pi-search search-icon"></span>
            <input type="text" placeholder="Search for shift" [(ngModel)]="searchText" (input)="onSearch()" />
        </div>
    </div>

    <div class="page-content mt-3">
        <!-- Table Header -->
        <div class="table-header">
            <h3 class="table-title">Created shifts</h3>
            <p-button label="Create Shift" styleClass="assginCandidate-btn"
                (click)="showcreateShiftDialog = true"></p-button>
        </div>

        <!-- Attendance Style Table -->
        <p-table [value]="shifts" [rows]="pageSize" [totalRecords]="totalRecords" [lazy]="true"
            (onLazyLoad)="onPageChange($event)" styleClass="candidates-table" [tableStyle]="{ 'min-width': '70rem' }">
            <!-- Header -->
            <ng-template pTemplate="header">
                <tr>
                    <th>Shift Name</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Pause Option</th>
                    <th>Assignation</th>
                    <th></th>
                </tr>
            </ng-template>

            <!-- Body -->
            <ng-template pTemplate="body" let-record>
                <tr>
                    <td class="shift-name">{{ record.name }}</td>
                    <td>{{ formatTo12Hour(record.fromTime) }}</td>
                    <td>{{ formatTo12Hour(record.toTime) }}</td>
                    <td>{{ formatTo12Hour(record.maxPauseDuration) }}</td>
                    <td>
                        {{ getAssignPreview(record.assignation).text }}
                        <span *ngIf="getAssignPreview(record.assignation).remaining > 0" class="remaining-count">
                            +{{ getAssignPreview(record.assignation).remaining }}
                        </span>
                    </td>
                    <td class="actions-cell">
                        <img class="mx-2" src="../../../../../../assets/images/edit.png" (click)="editShift(record)" />

                        <img src="../../../../../../assets/images/trash.png" (click)="confirmDeleteShift(record)" />
                    </td>
                </tr>
            </ng-template>

            <!-- Empty State -->
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="6" class="empty-message">
                        <div class="empty-state">
                            <i class="pi pi-calendar-times empty-icon"></i>
                            <p>No shifts found</p>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
        <div class="pagination-wrapper">
            <span class="page-info">Page {{ shiftsPageNumber }} of {{ shiftsTotalPages }}</span>
            <div class="page-controls">
                <p-button styleClass="page-btn" (click)="shiftsPrevious()"
                    [disabled]="shiftsPageNumber === 1">Previous</p-button>
                <p-button styleClass="page-btn" (click)="shiftsNext()"
                    [disabled]="shiftsPageNumber >= shiftsTotalPages">Next</p-button>
            </div>
        </div>
    </div>
</div>

<!-- Dialogs زي ما عندك -->

<p-dialog [(visible)]="showcreateShiftDialog" [modal]="true" [closable]="true" [draggable]="false" [resizable]="false"
    styleClass="add-candidate-dialog special-dialog" header="Add New Shift" [style]="{ width: '600px', minHeight: '600px' }"
    (onHide)="onDialogHide()">
    <form [formGroup]="createShiftForm" class="candidate-form">

        <div class="form-field">
            <label>Shift Name</label>
            <input type="text" pInputText formControlName="shiftName" placeholder="Enter shift name"
                class="form-input" />
            <div class="error-message"
                *ngIf="createShiftForm.get('shiftName')?.invalid && createShiftForm.get('shiftName')?.touched">
                Name is required (min 2 characters)
            </div>
        </div>

        <!-- From & To Time بجنب بعض -->
        <div class="form-row">
            <div class="form-field flex-item">
                <label>From Time</label>
                <p-calendar formControlName="fromTime" placeholder="Select time" [showIcon]="true" timeOnly="true"
                    hourFormat="12" class="calendar-input">
                </p-calendar>
            </div>

            <div class="form-field flex-item">
                <label>To Time</label>
                <p-calendar formControlName="toTime" placeholder="Select time" [showIcon]="true" timeOnly="true"
                    hourFormat="12" class="calendar-input">
                </p-calendar>
            </div>
        </div>


        <div class="form-field">
            <label>Pause</label>
            <div class="switch" [class.on]="createShiftForm.get('pauseOption')?.value" (click)="togglePause()">
                <div class="slider"></div>
            </div>
        </div>

        <div class="form-field" *ngIf="createShiftForm.get('pauseOption')?.value">
            <label>Max Pause Duration</label>
            <p-calendar formControlName="maxPauseDuration" placeholder="00:00" [showIcon]="true" timeOnly="true"
                hourFormat="12" class="calendar-input">
            </p-calendar>
        </div>
        <div class="form-row">
            <div class="form-field flex-item">
                <label>Margin Before</label>
                <p-calendar formControlName="marginBefore" placeholder="00:00" [showIcon]="true" timeOnly="true"
                    hourFormat="12" class="calendar-input" appendTo="body">
                </p-calendar>
            </div>

            <div class="form-field flex-item">
                <label>Margin After</label>
                <p-calendar formControlName="marginAfter" placeholder="00:00" [showIcon]="true" timeOnly="true"
                    hourFormat="12" class="calendar-input" appendTo="body">
                </p-calendar>
            </div>
        </div>

    </form>
    <ng-template pTemplate="footer">
        <div class="dialog-footer">
            <p-button label="Cancel" class="cancel-btn px-1" (onClick)="showcreateShiftDialog = false"></p-button>
            <p-button label="Save" styleClass="save-btn" (onClick)="saveShift()"></p-button>
        </div>
    </ng-template>

</p-dialog>


<!-- Delete Conirmation -->
<p-dialog [(visible)]="showDeleteDialog" [modal]="true" [closable]="false" [style]="{ width: '500px' }"
   >
   <div class="delIcon">
    <img src="../../../../../../assets/images/Frame 248.png">
    </div>
    <div class="d-flex justify-content-center mt-2">
        <p>Are you sure you want to delete <strong>{{ selectedShift?.name }}</strong>?</p>
    </div>
    <ng-template pTemplate="footer">
        <div class="d-flex justify-content-center gap-2">
            <p-button  type="button" label="Cancel" class="cancel-btn" (click)="showDeleteDialog = false"></p-button>

            <p-button  type="button" label="Delete" styleClass="confirm-button" (click)="deleteShift()"></p-button>
        </div>
    </ng-template>
</p-dialog>
